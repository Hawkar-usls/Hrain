<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Open Source MindMap (jsMind)</title>
    
    <style type="text/css">
        /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è jsMind */
        jmind {
            display: block;
            width: 100%;
            height: 100%;
            border: 1px solid #ccc;
            background-color: #f4f4f4;
            overflow: auto;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–ª–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #333;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        #toolbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 10px;
            background: #1e1e1e;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            color: white;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ–±–ª–∞—Å—Ç–∏ –∫–∞—Ä—Ç—ã */
        #map_container {
            width: 100%;
            height: calc(100% - 60px); /* –û—Ç—Å—Ç—É–ø –æ—Ç –ø–∞–Ω–µ–ª–∏ */
            margin-top: 60px;
        }

        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
        #toolbar button {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        #toolbar button:hover {
            background-color: #0056b3;
        }
        
    </style>
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jsmind@0.5.10/dist/jsmind.min.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsmind@0.5.10/style/jsmind.css" />

</head>
<body>

    <div id="toolbar">
        <button onclick="add_node_button()">+ –î–æ–±–∞–≤–∏—Ç—å –£–∑–µ–ª</button>
        <button onclick="remove_node_button()">- –£–¥–∞–ª–∏—Ç—å –£–∑–µ–ª</button>
        <button onclick="expand_node_button()">–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å/–°–≤–µ—Ä–Ω—É—Ç—å</button>
        
        <button onclick="export_json_button()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å (JSON)</button>
        <button onclick="import_json_button()">üì• –ó–∞–≥—Ä—É–∑–∏—Ç—å (JSON)</button>
        <button onclick="export_png_button()">üñºÔ∏è –≠–∫—Å–ø–æ—Ä—Ç (PNG)</button>
    </div>

    <div id="map_container">
        <jmind id="jsmind_container"></jmind>
    </div>

    <script type="text/javascript">
        
        // --- 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ ---
        
        var jm = null;
        
        function load_jsmind() {
            var mind = {
                "meta": {
                    "name": "Open Source –ö–∞—Ä—Ç–∞ –ú—ã—à–ª–µ–Ω–∏—è",
                    "author": "HRAIN Open Source",
                    "version": "v1.0"
                },
                "format": "node_array",
                "data": [
                    // –ö–æ—Ä–µ–Ω—å –∫–∞—Ä—Ç—ã
                    {"id": "root", "isroot": true, "topic": "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ò–¥–µ—è üí°"},
                    
                    // –í–µ—Ç–≤–∏
                    {"id": "branch1", "parentid": "root", "topic": "–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª"},
                    {"id": "branch2", "parentid": "root", "topic": "–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è", "expanded": false},
                    
                    // –ü–æ–¥-–≤–µ—Ç–≤–∏
                    {"id": "func1", "parentid": "branch1", "topic": "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–≠–∫—Å–ø–æ—Ä—Ç JSON)"},
                    {"id": "func2", "parentid": "branch1", "topic": "–£–¥–∞–ª–µ–Ω–∏–µ —É–∑–ª–æ–≤ –∏ —Å–≤—è–∑–µ–π"},
                    {"id": "vis1", "parentid": "branch2", "topic": "–ö—Ä–∏–≤—ã–µ –ª–∏–Ω–∏–∏ –ë–µ–∑—å–µ"},
                    {"id": "vis2", "parentid": "branch2", "topic": "–¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ"},
                ]
            };
            
            var options = {
                container: 'jsmind_container',
                editable: true, // –ü–æ–∑–≤–æ–ª—è–µ—Ç –¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                theme: 'primary',
                view: {
                    engine: 'svg' // –ò—Å–ø–æ–ª—å–∑—É–µ–º SVG –¥–ª—è –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞
                }
            }
            
            jm = jsMind.show(options, mind);
        }

        // --- 4. –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ---
        
        function add_node_button() {
            var selected_node = jm.get_selected_node();
            if (!selected_node) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π —É–∑–µ–ª.');
                return;
            }
            var nodeid = jsMind.util.uuid.newid();
            var topic = prompt('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ —É–∑–ª–∞:', '–ù–æ–≤—ã–π –£–∑–µ–ª');
            if (topic) {
                jm.add_node(selected_node, nodeid, topic, null, null, null, null, 'right');
            }
        }

        function remove_node_button() {
            var selected_node = jm.get_selected_node();
            if (!selected_node) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —É–∑–µ–ª –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è.');
                return;
            }
            if (selected_node.isroot) {
                alert('–ö–æ—Ä–Ω–µ–≤–æ–π —É–∑–µ–ª —É–¥–∞–ª–∏—Ç—å –Ω–µ–ª—å–∑—è.');
                return;
            }
            jm.remove_node(selected_node.id);
        }

        function expand_node_button() {
            var selected_node = jm.get_selected_node();
            if (!selected_node) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —É–∑–µ–ª.');
                return;
            }
            jm.toggle_node(selected_node.id);
        }
        
        // --- 5. –§—É–Ω–∫—Ü–∏–∏ –ò–º–ø–æ—Ä—Ç–∞ / –≠–∫—Å–ø–æ—Ä—Ç–∞ (–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ) ---

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ JSON-—Ñ–∞–π–ª
        function export_json_button() {
            if (!jm) return;
            var mind_data = jm.get_data('json');
            var mind_json = jsMind.util.json.stringify(mind_data);

            var blob = new Blob([mind_json], {type: "application/json;charset=utf-8"});
            var filename = 'mindmap_' + new Date().getTime() + '.json';
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
            var a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ JSON-—Ñ–∞–π–ª–∞
        function import_json_button() {
            var input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                var file = e.target.files[0];
                if (!file) return;

                var reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        var mind_json = e.target.result;
                        var mind_data = jsMind.util.json.parse(mind_json);
                        
                        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É –∏–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                        jm.show({
                             container: 'jsmind_container',
                             editable: true, 
                             theme: 'primary',
                             view: { engine: 'svg' }
                        }, mind_data);
                        alert('–ö–∞—Ä—Ç–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!');
                    } catch (error) {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–ª–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ —Ñ–∞–π–ª–∞ JSON: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –≤ PNG (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª jsMind)
        function export_png_button() {
            if (!jm) return;
            jm.shoot('png'); 
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        load_jsmind();

    </script>
</body>
</html>
